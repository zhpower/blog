<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1759" height="2801"><desc>title%20drm_atomic%0A%0AApp%20-%3E%20libdrm%3AdrmSetClientCap(fd%2C%20%5Cn%20%20%20%20%3Ccolor%3A%23red%3EDRM_CLIENT_CAP_ATOMIC%3C%2Fcolor%3E%2C%201)%3B%0A%0Alibdrm%20-%3E%20drm_drv%3Aioctl(%3Ccolor%3A%23red%3EDRM_CLIENT_CAP_ATOMIC%3C%2Fcolor%3E)%0Arbox%20right%20of%20drm_drv%3Adrm_setclientcap(%20)%5Cn%20%20%20if(%20!drm_core_check_feature(dev%2C%20%3Ccolor%3A%23red%3EDRIVER_ATOMIC%3C%2Fcolor%3E))%20return%20false%5Cn%20%20%20%3Ccolor%3A%23green%3Eor%3C%2Fcolor%3E%5Cn%20%20%20file_priv-%3Eatomic%20%3D%201%3B%5Cn%20%20%20file_priv-%3Euniversal_planes%20%3D%201%3B%0A%0A%3D%3D%3D%3D%0AApp-%3Elibdrm%3AdrmModeAtomicAlloc(%20)%20%20%20%20%20%20%20%20%20%20%20%20%0Arbox%20right%20of%20libdrm%3AdrmMalloc(%20)%5Cn%5C%2F%5C%2F%20%E5%88%86%E9%85%8D%20%3Ccolor%3A%23purple%3EdmModeAtomicReqPtr%3C%2Fcolor%3E%0AApp%3C%3C--libdrm%3A%3Ccolor%3A%23purple%3EdmModeAtomicReqPtr%3C%2Fcolor%3E%0AApp-%3Elibdrm%3AdrmModeAtomicAddProperty(%20)%0Arbox%20right%20of%20libdrm%3Asave%20to%20%3Ccolor%3A%23purple%3EdmModeAtomicReqPtr%3C%2Fcolor%3E%0AApp-%3Elibdrm%3AdrmModeAtomicCommit()%20%20%20%20%20%20%20%20%0Alibdrm-%3Edrm_drv%3Aiotcl(%3Ccolor%3A%23red%3EDRM_IOCTL_MODE_ATOMIC%3C%2Fcolor%3E)%0A%0Adrm_drv%20-%3E%20drm_atomic_uapi%3Adrm_mode_atomic_ioctl(%20)%0Adrm_atomic_uapi%20-%3E%20drm_atomic%3A%3Cbackground%3A%23yellow%3Edrm_atomic_state_alloc(%20)%3C%2Fbackground%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0Arbox%20left%20of%20drm_atomic%3Aif%20config-%3Efuncs-%3Eatomic_state_alloc%20no%20NULL%5Cn%20%20%20%20%20%3Ccolor%3A%23red%3Econfig-%3Efuncs-%3Eatomic_state_alloc(%20)%3C%2Fcolor%3E%5Cn%20%20%20%20%20%20%5C%2F%5C%2Fdrm_mode_config_funcs%E4%B8%AD%E8%AE%BE%E5%AE%9A%5Cn%5Cn%20%20%20%20%3Cbackground%3A%23yellow%3Eor%3C%2Fbackground%3E%5Cn%20%20%20%20%20%20kzalloc(sizeof(drm_atomic_state))%5Cn%20%20%20%20%20%20%3Ccolor%3A%23green%3Edrm_atomic_state_init%3C%2Fcolor%3E(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%201.%20kcalloc(num*sizeof(%3Ccolor%3A%23purple%3E__drm_crtcs_state%3C%2Fcolor%3E))%20%20%20%20%5C-%5C-%3E%20state-%3Ecrtcs%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%202.%20kcalloc(num*sizeof(%3Ccolor%3A%23purple%3E__drm_planes_state%3C%2Fcolor%3E))%20%20%5C-%5C-%3E%20state-%3Eplanes%0A%0A%0Arbox%20right%20of%20drm_atomic_uapi%3Afor%20each%20obj%5Cn%20%20for%20each%20prop%5Cn%20%20%20%20%20drm_atomic_set_property(%20)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20case%20connector%3A%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_atomic_get_connector_state()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_atomic_connector_set_property()%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20case%20crtc%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_atomic_get_crtc_state(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_atomic_crtc_set_property(%20)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20case%20plane%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_atomic_get_plane_state(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_atomic_plane_set_property(%20)%0A%0Agroup%20connector%0A%0Adrm_atomic_uapi-%3Edrm_atomic%3Adrm_atomic_get_connector_state(%20)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0Arbox%20left%20of%20drm_atomic%3Aconnector-%3Efuncs-%3E%3Ccolor%3A%23red%3Eatomic_duplicate_state%3C%2Fcolor%3E(connector)%3B%5Cn%5C%2F%5C%2F%E5%BE%97%E5%88%B0new%20connector_state%5Cn%5Cn%5C%2F%5C%2F%20state%E6%98%AF%E5%9C%A8%3Ccolor%3A%23green%3Edrm_atomic_state_init%3C%2Fcolor%3E()%E4%B8%AD%E5%88%86%E9%85%8D%5Cn%09state-%3Econnectors%5Bindex%5D.%3Ccolor%3A%23red%3Eold_state%3C%2Fcolor%3E%20%3D%20connector-%3Estate%3B%5Cn%09state-%3Econnectors%5Bindex%5D.%3Ccolor%3A%23red%3Enew_state%3C%2Fcolor%3E%20%3D%20connector_state%3B%5Cn%09state-%3Econnectors%5Bindex%5D.ptr%20%3D%20connector%3B%5Cn%09connector_state-%3Estate%20%3D%20state%3B%5Cn%5Cnreturn%20new%20%3Ccolor%3A%23red%3Econnector_state%3C%2Fcolor%3E%0Adrm_atomic_uapi-%3Edrm_atomic%3Adrm_atomic_connector_set_property(%20%3Ccolor%3A%23red%3Econnector_state%3C%2Fcolor%3E%20)%0Arbox%20left%20of%20drm_atomic%3Aif%20prpoperty%20%E5%86%85%E9%83%A8%E5%AE%9A%E4%B9%89%5Cn%20%20%20%E8%AE%BE%E7%BD%AE%3Ccolor%3A%23red%3Econnector_state%3C%2Fcolor%3E%20%E5%AF%B9%E5%BA%94%E5%AD%97%E6%AE%B5%5Cn%5Cn%3Cbackground%3A%23yellow%3Eor%3C%2Fbackground%3E%5Cn%20%20%20%20%E8%B0%83%E7%94%A8connector-%3Efuncs-%3E%3Ccolor%3A%23red%3Eatomic_set_property%3C%2Fcolor%3E(%20)%0A%0Aend%0Agroup%20crtc%20plane%20%E4%B8%8Econnector%E7%9B%B8%E4%BC%BC%E6%93%8D%E4%BD%9C%0Adrm_atomic_uapi-%3Edrm_atomic%3Adrm_atomic_get_%3Ccolor%3A%23purple%3Exxx%3C%2Fcolor%3E_state(%20)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0Adrm_atomic_uapi-%3Edrm_atomic%3Adrm_atomic_%3Ccolor%3A%23purple%3Exxx%3C%2Fcolor%3E_set_property(%20%3Ccolor%3A%23red%3Exxx_state%3C%2Fcolor%3E%20)%20%20%20%20%20%20%20%20%20%20%0Aend%0Arbox%20right%20of%20drm_atomic_uapi%3A%3Cbackground%3A%23yellow%3Eprepare_signaling(%20)%3C%2Fbackground%3E%5Cn%20%5Cn%20%20%20%20%20%20%20%20for%20each%20crtc%20%5C%2F%5C%2F%20%3Cbackground%3A%23purple%3ETODO%3A%3C%2Fbackground%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20drm_crtc_create_fence()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20setup_out_fence()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20%E6%9E%84%E5%BB%BA%E6%96%B0fence%EF%BC%8C%20%E6%8A%8A%E6%89%80%E6%9C%89fence%E4%BF%9D%E5%AD%98%E5%88%B0%20fence_state%5Cn%5Cn%20%20%20%20%20%20%20%20%20for%20each%20connector%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20for%20writeback%20%E5%9B%9E%E5%86%99%E8%BF%9E%E6%8E%A5%E5%99%A8%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%0Adrm_atomic_uapi-%3Edrm_atomic%3A%3Cbackground%3A%23yellow%3Edrm_atomic_commit%3C%2Fbackground%3E(%20)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Cn%20%20%20%20%5C-%5C-%3E%3Ccolor%3A%23red%3Econfig-%3Efuncs-%3Eatomic_commit%3C%2Fcolor%3E(%20)%0Arbox%20right%20of%20drm_atomic_uapi%3A%3Cbackground%3A%23yellow%3Ecomplete_signaling%3C%2Fbackground%3E(%20)%5Cn%5Cn%20%20%20%20%20if%20atomic_commit()%20%E6%88%90%E5%8A%9F%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%5C-%5C-%3E%20fd_install(fence_state%5Bi%5D.fd%2C%20fence_state%5Bi%5D.sync_file-%3Efile)%5Cn%5Cn%20%20%20%20%20%20or%5Cn%20%20%20%20%20%20%20%20%20%20fput(fence_state%5Bi%5D.fd)%5Cn%20%20%20%20%20%20%20%20%20%20put_unused_fd(fence_state%5Bi%5D.sync_file-%3Efile)%3B%0Arbox%20right%20of%20drm_drv%3A%5C%2F%5C%2Fdrm%20%E6%8F%90%E4%BE%9B%E7%9A%84%20config%20atomic_commit%E5%AE%9E%E7%8E%B0%5Cn%5Cndrm_atomic_helper_commit(%20)</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1759" height="2801"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.40332885058203 103.10369087072726 L 42.40332885058203 2801.6792760307267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 322.70054617506116 103.10369087072726 L 322.70054617506116 2801.6792760307267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 608.6528080552043 103.10369087072726 L 608.6528080552043 2801.6792760307267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 103.10369087072726 L 1126.9618133236418 2801.6792760307267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1680.4317225227433 103.10369087072726 L 1680.4317225227433 2801.6792760307267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878699999996 55.60594589072727 L 76.01077900116405 55.60594589072727 L 76.01077900116405 103.10369087072726 L 8.795878699999996 103.10369087072726 L 8.795878699999996 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">App</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 280.6893637246744 55.60594589072727 L 364.71172862544785 55.60594589072727 L 364.71172862544785 103.10369087072726 L 280.6893637246744 103.10369087072726 L 280.6893637246744 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="299.77642050367444" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">libdrm</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 560.2851345159504 55.60594589072727 L 657.0204815944583 55.60594589072727 L 657.0204815944583 103.10369087072726 L 560.2851345159504 103.10369087072726 L 560.2851345159504 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="579.3721912949504" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_drv</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1047.8854834733527 55.60594589072727 L 1206.0381431739308 55.60594589072727 L 1206.0381431739308 103.10369087072726 L 1047.8854834733527 103.10369087072726 L 1047.8854834733527 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1066.9725402523527" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_uapi</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1619.841430880462 55.60594589072727 L 1741.0220141650245 55.60594589072727 L 1741.0220141650245 103.10369087072726 L 1619.841430880462 103.10369087072726 L 1619.841430880462 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1638.928487659462" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="819.113639831543" y="26.547561167272725" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic</text></g><g><g><rect fill="white" stroke="none" x="63.22024177391533" y="138.28720567072725" width="151.11862219070312" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="63.22024177391533" y="155.87896307072725" width="238.6633914778125" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.85900538391533" y="154.11978733072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmSetClientCap(fd, </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="65.85900538391533" y="171.71154473072727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="83.21044581360283" y="171.71154473072727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DRM_CLIENT_CAP_ATOMIC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="274.3558162970013" y="171.71154473072727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">, 1);</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.40332885058203 178.74824769072725 L 308.21666591572784 178.74824769072725" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(322.70054617506116,178.74824769072725) translate(-322.70054617506116,-178.74824769072725)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.0407483417278 171.41834877406058 L 322.70054617506116 178.74824769072725 L 308.0407483417278 186.07814660739393 Z"/></g></g><g><g><rect fill="white" stroke="none" x="347.6012298503476" y="205.13588379072726" width="236.1508945295703" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="350.2399934603476" y="220.96846545072728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ioctl(</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="385.0717805697226" y="220.96846545072728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DRM_CLIENT_CAP_ATOMIC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="576.217151053121" y="220.96846545072728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 322.70054617506116 228.00516841072726 L 594.168927795871 228.00516841072726" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(608.6528080552043,228.00516841072726) translate(-608.6528080552043,-228.00516841072726)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 593.993010221871 220.6752694940606 L 608.6528080552043 228.00516841072726 L 593.993010221871 235.33506732739394 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 608.6528080552043 309.80684032072725 L 617.4486867552043 309.80684032072725 M 617.4486867552043 270.2253861707273 L 617.4486867552043 270.2253861707273 A 15.832581659999999 15.832581659999999 0 0 1 633.2812684152043 254.3928045107273 L 1102.3333529636418 254.39280451072727 L 1102.3333529636418 254.3928045107273 A 15.832581659999999 15.832581659999999 0 0 1 1118.1659346236418 270.2253861707273 L 1118.1659346236418 349.38829447072726 L 1118.1659346236418 349.38829447072726 A 15.832581659999999 15.832581659999999 0 0 1 1102.3333529636418 365.2208761307273 L 633.2812684152043 365.2208761307273 L 633.2812684152043 365.2208761307273 A 15.832581659999999 15.832581659999999 0 0 1 617.4486867552043 349.38829447072726 L 617.4486867552043 270.2253861707273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="279.0212648707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_setclientcap( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="296.6130222707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   if( !drm_core_check_feature(dev, </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="883.6519762167668" y="296.6130222707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DRIVER_ATOMIC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1000.072920430634" y="296.6130222707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">)) return false</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="314.2047796707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   </text><text fill="green" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="655.0907274374699" y="314.2047796707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="331.7965370707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   file_priv-&gt;atomic = 1;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="349.3882944707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   file_priv-&gt;universal_planes = 1;</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 8.7958787 405.9751141073939 L 1750.2041213 405.9751141073939 M 8.7958787 411.83903324072725 L 1750.2041213 411.83903324072725 M 8.7958787 417.7029523740606 L 1750.2041213 417.7029523740606" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><g><rect fill="white" stroke="none" x="69.53738044579033" y="458.4571903507273" width="226.0291141340625" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="72.17614405579033" y="474.2897720107273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmModeAtomicAlloc( )            </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.40332885058203 481.32647497072725 L 308.21666591572784 481.32647497072725" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(322.70054617506116,481.32647497072725) translate(-322.70054617506116,-481.32647497072725)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.0407483417278 473.9965760540606 L 322.70054617506116 481.32647497072725 L 308.0407483417278 488.6563738873939 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 322.70054617506116 536.7405107807273 L 331.49642487506117 536.7405107807273 M 331.49642487506117 523.5466927307273 L 331.49642487506117 523.5466927307273 A 15.832581659999999 15.832581659999999 0 0 1 347.3290065350612 507.71411107072726 L 576.5027951850611 507.71411107072726 L 576.5027951850611 507.71411107072726 A 15.832581659999999 15.832581659999999 0 0 1 592.3353768450611 523.5466927307273 L 592.3353768450611 549.9343288307273 L 592.3353768450611 549.9343288307273 A 15.832581659999999 15.832581659999999 0 0 1 576.5027951850611 565.7669104907272 L 347.3290065350612 565.7669104907272 L 347.3290065350612 565.7669104907272 A 15.832581659999999 15.832581659999999 0 0 1 331.49642487506117 549.9343288307273 L 331.49642487506117 523.5466927307273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="356.12488523506113" y="532.3425714307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmMalloc( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="356.12488523506113" y="549.9343288307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">// 分配 </text><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="406.6474377252955" y="549.9343288307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">dmModeAtomicReqPtr</text></g><g><g><rect fill="white" stroke="none" x="99.38343452293877" y="592.1545465907273" width="166.33700597976562" height="22.86928462"/></g><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="102.02219813293877" y="607.9871282507272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">dmModeAtomicReqPtr</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 322.70054617506116 615.0238312107273 L 44.60229852558203 615.0238312107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="7.0367029599999995"/><g transform="translate(42.40332885058203,615.0238312107273) translate(-42.40332885058203,-615.0238312107273)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 57.475130493870985 608.3001723800559 L 44.05134409040454 615.0238312107273 L 57.475130493870985 621.7474900413987" stroke-miterlimit="10" stroke-width="1.4659797833333332"/></g></g><g><g><rect fill="white" stroke="none" x="68.10569404442315" y="641.4114673107273" width="228.89248693679687" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="70.74445765442314" y="657.2440489707272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmModeAtomicAddProperty( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.40332885058203 664.2807519307273 L 308.21666591572784 664.2807519307273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(322.70054617506116,664.2807519307273) translate(-322.70054617506116,-664.2807519307273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.0407483417278 656.9508530140606 L 322.70054617506116 664.2807519307273 L 308.0407483417278 671.610650847394 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 322.70054617506116 710.8989090407273 L 331.49642487506117 710.8989090407273 M 331.49642487506117 706.5009696907272 L 331.49642487506117 706.5009696907272 A 15.832581659999999 15.832581659999999 0 0 1 347.3290065350612 690.6683880307272 L 580.124819721194 690.6683880307272 L 580.124819721194 690.6683880307272 A 15.832581659999999 15.832581659999999 0 0 1 595.9574013811939 706.5009696907272 L 595.9574013811939 715.2968483907273 L 595.9574013811939 715.2968483907273 A 15.832581659999999 15.832581659999999 0 0 1 580.124819721194 731.1294300507273 L 347.3290065350612 731.1294300507273 L 347.3290065350612 731.1294300507273 A 15.832581659999999 15.832581659999999 0 0 1 331.49642487506117 715.2968483907273 L 331.49642487506117 706.5009696907272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="356.12488523506113" y="715.2968483907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">save to </text><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="410.2694622614283" y="715.2968483907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">dmModeAtomicReqPtr</text></g><g><g><rect fill="white" stroke="none" x="69.79504798729424" y="757.5170661507273" width="225.51377905105468" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="72.43381159729424" y="773.3496478107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmModeAtomicCommit()        </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 42.40332885058203 780.3863507707273 L 308.21666591572784 780.3863507707273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(322.70054617506116,780.3863507707273) translate(-322.70054617506116,-780.3863507707273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 308.0407483417278 773.0564518540606 L 322.70054617506116 780.3863507707273 L 308.0407483417278 787.716249687394 Z"/></g></g><g><g><rect fill="white" stroke="none" x="343.51745909839445" y="806.7739868707273" width="244.31843603347656" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="346.15622270839447" y="822.6065685307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">iotcl(</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="380.7804292513632" y="822.6065685307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">DRM_IOCTL_MODE_ATOMIC</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="580.3009218050742" y="822.6065685307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 322.70054617506116 829.6432714907273 L 594.168927795871 829.6432714907273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(608.6528080552043,829.6432714907273) translate(-608.6528080552043,-829.6432714907273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 593.993010221871 822.3133725740606 L 608.6528080552043 829.6432714907273 L 593.993010221871 836.973170407394 Z"/></g></g><g><g><rect fill="white" stroke="none" x="774.6853393767864" y="856.0309075907273" width="186.24394262527343" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="777.3241029867863" y="871.8634892507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mode_atomic_ioctl( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 608.6528080552043 878.9001922107274 L 1112.4779330643084 878.9001922107274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1126.9618133236418,878.9001922107274) translate(-1126.9618133236418,-878.9001922107274)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1112.3020154903083 871.5702932940607 L 1126.9618133236418 878.9001922107274 L 1112.3020154903083 886.2300911273941 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1167.3073252970792" y="905.2878283107274" width="472.7788852522266" height="22.86928462"/></g><g><rect fill="yellow" stroke="none" x="1169.9460889070792" y="908.1025094947273" width="176.86473083496094" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1169.9460889070792" y="921.1204099707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_state_alloc( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1346.8108197420402" y="921.1204099707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                                                                   </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 928.1571129307274 L 1665.94784226341 928.1571129307274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1680.4317225227433,928.1571129307274) translate(-1680.4317225227433,-928.1571129307274)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1665.7719246894098 920.8272140140607 L 1680.4317225227433 928.1571129307274 L 1665.7719246894098 935.4870118473941 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1680.4317225227433 1045.1422996407273 L 1671.6358438227433 1045.1422996407273 M 1135.7576920236418 970.3773306907274 L 1135.7576920236418 970.3773306907274 A 15.832581659999999 15.832581659999999 0 0 1 1151.5902736836417 954.5447490307274 L 1655.8032621627435 954.5447490307274 L 1655.8032621627435 954.5447490307274 A 15.832581659999999 15.832581659999999 0 0 1 1671.6358438227435 970.3773306907274 L 1671.6358438227435 1119.9072685907274 L 1671.6358438227435 1119.9072685907274 A 15.832581659999999 15.832581659999999 0 0 1 1655.8032621627435 1135.7398502507274 L 1151.5902736836417 1135.7398502507274 L 1151.5902736836417 1135.7398502507274 A 15.832581659999999 15.832581659999999 0 0 1 1135.7576920236418 1119.9072685907274 L 1135.7576920236418 970.3773306907274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="979.1732093907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if config-&gt;funcs-&gt;atomic_state_alloc no NULL</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="996.7649667907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1182.075452920751" y="996.7649667907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">config-&gt;funcs-&gt;atomic_state_alloc( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1014.3567241907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      //drm_mode_config_funcs中设定</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1049.5402389907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    </text><g><rect fill="yellow" stroke="none" x="1177.7375928133292" y="1036.5223385147272" width="14.917678833007812" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1177.7375928133292" y="1049.5402389907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1067.1319963907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      kzalloc(sizeof(drm_atomic_state))</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1084.7237537907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      </text><text fill="green" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1186.413313028173" y="1084.7237537907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_state_init</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1338.8685895174308" y="1084.7237537907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1102.3155111907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             1. kcalloc(num*sizeof(</text><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1369.4340344637199" y="1102.3155111907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">__drm_crtcs_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1491.2092877596183" y="1102.3155111907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">))    --&gt; state-&gt;crtcs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1119.9072685907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             2. kcalloc(num*sizeof(</text><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1369.4340344637199" y="1119.9072685907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">__drm_planes_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1503.9150677889152" y="1119.9072685907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">))  --&gt; state-&gt;planes</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 1305.5003091607273 L 1135.7576920236418 1305.5003091607273 M 1135.7576920236418 1177.9600680107274 L 1135.7576920236418 1177.9600680107274 A 15.832581659999999 15.832581659999999 0 0 1 1151.5902736836417 1162.1274863507274 L 1503.3623594527824 1162.1274863507274 L 1503.3623594527824 1162.1274863507274 A 15.832581659999999 15.832581659999999 0 0 1 1519.1949411127823 1177.9600680107274 L 1519.1949411127823 1433.0405503107274 L 1519.1949411127823 1433.0405503107274 A 15.832581659999999 15.832581659999999 0 0 1 1503.3623594527824 1448.8731319707274 L 1151.5902736836417 1448.8731319707274 L 1151.5902736836417 1448.8731319707274 A 15.832581659999999 15.832581659999999 0 0 1 1135.7576920236418 1433.0405503107274 L 1135.7576920236418 1177.9600680107274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1186.7559467107271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">for each obj</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1204.3477041107271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  for each prop</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1221.9394615107271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     drm_atomic_set_property( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1257.1229763107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           case connector:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1274.7147337107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                drm_atomic_get_connector_state()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1292.3064911107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                drm_atomic_connector_set_property()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1327.4900059107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           case crtc</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1345.0817633107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                drm_atomic_get_crtc_state( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1362.6735207107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                drm_atomic_crtc_set_property( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1397.8570355107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           case plane</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1415.4487929107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                drm_atomic_get_plane_state( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="1433.0405503107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                drm_atomic_plane_set_property( )</text></g><g><g><rect fill="white" stroke="none" x="1204.9736308390713" y="1522.7585130507275" width="397.4462741682422" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1207.6123944490714" y="1538.5910947107275" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_get_connector_state( )                                  </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 1545.6277976707274 L 1665.94784226341 1545.6277976707274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1680.4317225227433,1545.6277976707274) translate(-1680.4317225227433,-1545.6277976707274)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1665.7719246894098 1538.2978987540607 L 1680.4317225227433 1545.6277976707274 L 1665.7719246894098 1552.9576965873941 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1680.4317225227433 1671.4088630807273 L 1671.6358438227433 1671.4088630807273 M 1230.7253739084074 1587.8480154307274 L 1230.7253739084074 1587.8480154307274 A 15.832581659999999 15.832581659999999 0 0 1 1246.5579555684074 1572.0154337707274 L 1655.8032621627433 1572.0154337707274 L 1655.8032621627433 1572.0154337707274 A 15.832581659999999 15.832581659999999 0 0 1 1671.6358438227433 1587.8480154307274 L 1671.6358438227433 1754.9697107307275 L 1671.6358438227433 1754.9697107307275 A 15.832581659999999 15.832581659999999 0 0 1 1655.8032621627433 1770.8022923907274 L 1246.5579555684074 1770.8022923907274 L 1246.5579555684074 1770.8022923907274 A 15.832581659999999 15.832581659999999 0 0 1 1230.7253739084074 1754.9697107307275 L 1230.7253739084074 1587.8480154307274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1596.6438941307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">connector-&gt;funcs-&gt;</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1396.7425519197745" y="1596.6438941307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">atomic_duplicate_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1556.3345319002433" y="1596.6438941307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">(connector);</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1614.2356515307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//得到new connector_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1649.4191663307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">// state是在</text><text fill="green" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1335.547102090673" y="1649.4191663307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_state_init</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1488.0023785799308" y="1649.4191663307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">()中分配</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1667.0109237307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> state-&gt;connectors[index].</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1439.8563519686027" y="1667.0109237307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">old_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1503.0345898836417" y="1667.0109237307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> = connector-&gt;state;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1684.6026811307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> state-&gt;connectors[index].</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1439.8563519686027" y="1684.6026811307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">new_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1509.3624402254386" y="1684.6026811307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> = connector_state;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1702.1944385307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> state-&gt;connectors[index].ptr = connector;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1719.7861959307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> connector_state-&gt;state = state;</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1255.3538342684074" y="1754.9697107307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">return new </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1335.7618542879386" y="1754.9697107307272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">connector_state</text></g><g><g><rect fill="white" stroke="none" x="1208.710096293173" y="1797.1899284907274" width="389.9733432600391" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1211.348859903173" y="1813.0225101507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_connector_set_property( </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1475.5650769441886" y="1813.0225101507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">connector_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1586.8106061189933" y="1813.0225101507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 1820.0592131107273 L 1665.94784226341 1820.0592131107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1680.4317225227433,1820.0592131107273) translate(-1680.4317225227433,-1820.0592131107273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1665.7719246894098 1812.7293141940606 L 1680.4317225227433 1820.0592131107273 L 1665.7719246894098 1827.389112027394 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1680.4317225227433 1901.8608850207272 L 1671.6358438227433 1901.8608850207272 M 1277.697450324423 1862.2794308707273 L 1277.697450324423 1862.2794308707273 A 15.832581659999999 15.832581659999999 0 0 1 1293.530031984423 1846.4468492107274 L 1655.8032621627433 1846.4468492107274 L 1655.8032621627433 1846.4468492107274 A 15.832581659999999 15.832581659999999 0 0 1 1671.6358438227433 1862.2794308707273 L 1671.6358438227433 1941.4423391707273 L 1671.6358438227433 1941.4423391707273 A 15.832581659999999 15.832581659999999 0 0 1 1655.8032621627433 1957.2749208307273 L 1293.530031984423 1957.2749208307273 L 1293.530031984423 1957.2749208307273 A 15.832581659999999 15.832581659999999 0 0 1 1277.697450324423 1941.4423391707273 L 1277.697450324423 1862.2794308707273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1302.325910684423" y="1871.075309570727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if prpoperty 内部定义</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1302.325910684423" y="1888.667066970727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   设置</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1344.6594678133292" y="1888.667066970727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">connector_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1455.904996988134" y="1888.667066970727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> 对应字段</text><g><rect fill="yellow" stroke="none" x="1302.325910684423" y="1910.832681294727" width="14.917678833007812" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1302.325910684423" y="1923.850581770727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1302.325910684423" y="1941.442339170727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    调用connector-&gt;funcs-&gt;</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1490.3860455721183" y="1941.442339170727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">atomic_set_property</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1632.8771039217277" y="1941.442339170727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text></g><g><g><rect fill="white" stroke="none" x="1229.161184244833" y="2057.547938010727" width="349.0711673567188" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1231.7999478548331" y="2073.380519670727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_get_</text><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1351.1056424349113" y="2073.380519670727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">xxx</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1373.3962613313956" y="2073.380519670727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">_state( )                                  </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 2080.4172226307273 L 1665.94784226341 2080.4172226307273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1680.4317225227433,2080.4172226307273) translate(-1680.4317225227433,-2080.4172226307273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1665.7719246894098 2073.087323714061 L 1680.4317225227433 2080.4172226307273 L 1665.7719246894098 2087.747121547394 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1235.395902567587" y="2106.804858730727" width="336.60173071121096" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1238.034666177587" y="2122.637440390727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_</text><text fill="purple" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1327.6123639314933" y="2122.637440390727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">xxx</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1349.9029828279777" y="2122.637440390727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">_set_property( </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1453.8757764070792" y="2122.637440390727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">xxx_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1516.7461987703605" y="2122.637440390727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> )          </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 2129.6741433507273 L 1665.94784226341 2129.6741433507273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1680.4317225227433,2129.6741433507273) translate(-1680.4317225227433,-2129.6741433507273)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1665.7719246894098 2122.344244434061 L 1680.4317225227433 2129.6741433507273 L 1665.7719246894098 2137.0040422673937 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 2281.842844860727 L 1135.7576920236418 2281.842844860727 M 1135.7576920236418 2198.281997210727 L 1135.7576920236418 2198.281997210727 A 15.832581659999999 15.832581659999999 0 0 1 1151.5902736836417 2182.449415550727 L 1548.2657408004386 2182.449415550727 L 1548.2657408004386 2182.449415550727 A 15.832581659999999 15.832581659999999 0 0 1 1564.0983224604386 2198.281997210727 L 1564.0983224604386 2365.403692510727 L 1564.0983224604386 2365.403692510727 A 15.832581659999999 15.832581659999999 0 0 1 1548.2657408004386 2381.236274170727 L 1151.5902736836417 2381.236274170727 L 1151.5902736836417 2381.236274170727 A 15.832581659999999 15.832581659999999 0 0 1 1135.7576920236418 2365.403692510727 L 1135.7576920236418 2198.281997210727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><g><rect fill="yellow" stroke="none" x="1160.3861523836417" y="2194.059975434727" width="138.15318298339844" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2207.077875910727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">prepare_signaling( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2224.669633310727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2242.261390710727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        for each crtc // </text><g><rect fill="purple" stroke="none" x="1303.7790814607902" y="2229.2434902347272" width="46.284912109375" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1303.7790814607902" y="2242.261390710727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TODO:</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2259.853148110727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             drm_crtc_create_fence()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2277.444905510727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             setup_out_fence()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2295.036662910727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">            // 构建新fence， 把所有fence保存到 fence_state</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2330.220177710727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">         for each connector </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2347.811935110727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             // for writeback 回写连接器</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2365.403692510727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">            </text></g><g><g><rect fill="white" stroke="none" x="1161.9494227702237" y="2407.623910270727" width="483.4946903059375" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="1161.9494227702237" y="2425.215667670727" width="283.9318393537891" height="22.86928462"/></g><g><rect fill="yellow" stroke="none" x="1164.5881863802238" y="2410.438591454727" width="143.08523559570312" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1164.5881863802238" y="2423.4564919307268" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_commit</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1307.6734219759269" y="2423.4564919307268" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )                                                                          </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1164.5881863802238" y="2441.048249330727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    --&gt;</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1205.4972592562003" y="2441.048249330727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">config-&gt;funcs-&gt;atomic_commit</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1429.1122189729972" y="2441.048249330727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 2448.084952290727 L 1665.94784226341 2448.084952290727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1680.4317225227433,2448.084952290727) translate(-1680.4317225227433,-2448.084952290727)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1665.7719246894098 2440.7550533740605 L 1680.4317225227433 2448.084952290727 L 1665.7719246894098 2455.4148512073934 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1126.9618133236418 2556.274260300727 L 1135.7576920236418 2556.274260300727 M 1135.7576920236418 2490.3051700507267 L 1135.7576920236418 2490.3051700507267 A 15.832581659999999 15.832581659999999 0 0 1 1151.5902736836417 2474.4725883907267 L 1636.6408170943841 2474.4725883907267 L 1636.6408170943841 2474.4725883907267 A 15.832581659999999 15.832581659999999 0 0 1 1652.473398754384 2490.3051700507267 L 1652.473398754384 2622.243350550727 L 1652.473398754384 2622.243350550727 A 15.832581659999999 15.832581659999999 0 0 1 1636.6408170943841 2638.075932210727 L 1151.5902736836417 2638.075932210727 L 1151.5902736836417 2638.075932210727 A 15.832581659999999 15.832581659999999 0 0 1 1135.7576920236418 2622.243350550727 L 1135.7576920236418 2490.3051700507267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><g><rect fill="yellow" stroke="none" x="1160.3861523836417" y="2486.083148274727" width="135.63351440429688" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2499.101048750727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">complete_signaling</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1296.0196667879386" y="2499.101048750727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2534.284563550727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     if atomic_commit() 成功</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2551.876320950727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             --&gt; fd_install(fence_state[i].fd, fence_state[i].sync_file-&gt;file)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2587.059835750727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2604.651593150727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">          fput(fence_state[i].fd)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1160.3861523836417" y="2622.243350550727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">          put_unused_fd(fence_state[i].sync_file-&gt;file);</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 608.6528080552043 2702.285846720727 L 617.4486867552043 2702.285846720727 M 617.4486867552043 2680.2961499707267 L 617.4486867552043 2680.2961499707267 A 15.832581659999999 15.832581659999999 0 0 1 633.2812684152043 2664.4635683107267 L 930.2932833835637 2664.4635683107267 L 930.2932833835637 2664.4635683107267 A 15.832581659999999 15.832581659999999 0 0 1 946.1258650435636 2680.2961499707267 L 946.1258650435636 2724.275543470727 L 946.1258650435636 2724.275543470727 A 15.832581659999999 15.832581659999999 0 0 1 930.2932833835637 2740.108125130727 L 633.2812684152043 2740.108125130727 L 633.2812684152043 2740.108125130727 A 15.832581659999999 15.832581659999999 0 0 1 617.4486867552043 2724.275543470727 L 617.4486867552043 2680.2961499707267" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="2689.092028670727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//drm 提供的 config atomic_commit实现</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="642.0771471152043" y="2724.275543470727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_atomic_helper_commit( )</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1065.3906624236417 1475.2607680707274 L 1742.0028734227433 1475.2607680707274 L 1742.0028734227433 1983.6625569307273 L 1065.3906624236417 1983.6625569307273 L 1065.3906624236417 1475.2607680707274 Z" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1065.3906624236417 1475.2607680707274 L 1065.3906624236417 1496.3708769507275 L 1159.9171337666105 1496.3708769507275 L 1170.4721882066106 1485.8158225107275 L 1170.4721882066106 1475.2607680707274 L 1065.3906624236417 1475.2607680707274" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1082.9824198236417" y="1489.3341739907275" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">connector</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1065.3906624236417 2010.0501930307273 L 1742.0028734227433 2010.0501930307273 L 1742.0028734227433 2156.061779450727 L 1065.3906624236417 2156.061779450727 L 1065.3906624236417 2010.0501930307273 Z" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1065.3906624236417 2010.0501930307273 L 1065.3906624236417 2031.1603019107274 L 1280.2927136005949 2031.1603019107274 L 1290.847768040595 2020.6052474707274 L 1290.847768040595 2010.0501930307273 L 1065.3906624236417 2010.0501930307273" stroke-miterlimit="10" stroke-width="2.5131082" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="1082.9824198236417" y="2024.1235989507275" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">crtc plane 与connector相似操作</text></g></g><g/><g/><g/><g/><g/></g></g></g></g></g></g></g></g></svg>