<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="604" height="483"><desc>title%20drm_vlank_init%0A%0ADriver%20-%3Edrm_drv%3A%3Ccolor%3A%23ff0066%3Edrm_vlank_init%3C%2Fcolor%3E(%20)%0Arbox%20over%20drm_drv%3Adrmm_kcallor()%20%5C%2F%5C%2F%E4%B8%BA%E6%AF%8F%E4%B8%AAcrtc%E5%88%86%E9%85%8Dvblank_crtc%20%E7%BB%93%E6%9E%84%5Cn%5Cnfor%20each%20crtcs%5Cn%5Cn%20%20%201.%20timer_setup(disable_timer%2C%20vblank_disable_fn)%5Cn%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%E5%9C%A8drm_vblank_put()%E4%B8%AD%E9%80%9A%E8%BF%87mod_timer()%E6%9D%A5%E8%A7%A6%E5%8F%91%E3%80%82%5Cn%5Cn%20%20%202.%20drm_vblank_worker_init()%5Cn%20%20%20%20%20%20%20%20%20%20%20a.%20kthread_create_worker()%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%E5%88%9B%E5%BB%BAworker%EF%BC%8C%E4%BB%A5%E5%90%8E%E9%80%9A%E8%BF%87drm_vblank_work_schedule()%E5%8A%A0%E5%85%A5work%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20b.%20sched_set_fifo(worker%20%5C-%5C-%3Etask%20)%20%5C%2F%5C%2F%E5%8A%A0%E5%85%A5%E5%88%B0%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="604" height="483"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.97455687792578 103.10369087072726 L 48.97455687792578 483.08565071072735" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 326.63295050335546 103.10369087072726 L 326.63295050335546 483.08565071072735" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878699999996 55.60594589072727 L 89.15323505585155 55.60594589072727 L 89.15323505585155 103.10369087072726 L 8.795878699999996 103.10369087072726 L 8.795878699999996 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Driver</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 278.26527696410153 55.60594589072727 L 375.00062404260933 55.60594589072727 L 375.00062404260933 103.10369087072726 L 278.26527696410153 103.10369087072726 L 278.26527696410153 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="297.35233374310155" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_drv</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="228.64171600341797" y="26.547561167272725" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_vlank_init</text></g><g><g><rect fill="white" stroke="none" x="127.68108810310154" y="138.28720567072727" width="120.24533117507812" height="22.86928462"/></g><text fill="#ff0066" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.31985171310154" y="154.1197873307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_vlank_init</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="231.15737612716404" y="154.1197873307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.97455687792578 161.15649029072728 L 312.14907024402214 161.15649029072728" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(326.63295050335546,161.15649029072728) translate(-326.63295050335546,-161.15649029072728)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 311.9731526700221 153.8265913740606 L 326.63295050335546 161.15649029072728 L 311.9731526700221 168.48638920739396 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 57.77043557792575 203.37670805072727 L 57.77043557792575 203.37670805072727 A 15.832581659999999 15.832581659999999 0 0 1 73.60301723792576 187.54412639072729 L 579.6628837687852 187.54412639072729 L 579.6628837687852 187.54412639072729 A 15.832581659999999 15.832581659999999 0 0 1 595.4954654287851 203.37670805072727 L 595.4954654287851 405.6819181507273 L 595.4954654287851 405.6819181507273 A 15.832581659999999 15.832581659999999 0 0 1 579.6628837687852 421.51449981072733 L 73.60301723792576 421.51449981072733 L 73.60301723792576 421.51449981072733 A 15.832581659999999 15.832581659999999 0 0 1 57.77043557792575 405.6819181507273 L 57.77043557792575 203.37670805072727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="212.17258675072733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmm_kcallor() //为每个crtc分配vblank_crtc 结构</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="247.35610155072735" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">for each crtcs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="282.53961635072733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   1. timer_setup(disable_timer, vblank_disable_fn)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="300.13137375072733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">         //在drm_vblank_put()中通过mod_timer()来触发。</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="335.31488855072735" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   2. drm_vblank_worker_init()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="352.90664595072735" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           a. kthread_create_worker() </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="370.49840335072736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">              //创建worker，以后通过drm_vblank_work_schedule()加入work</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="82.39889593792577" y="405.68191815072737" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           b. sched_set_fifo(worker --&gt;task ) //加入到内核线程</text></g></g><g/><g/></g></svg>