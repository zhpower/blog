<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1849" height="1151"><desc>title%20drmModeAddFb%0A%0AUser%20-%3E%20libdrm%3A%20drmModeAddFb(%20)%0Alibdrm%20-%3E%20Driver%3Aioctl(DRM_IOCTL_MODE_ADDFB)%0Arbox%20over%20Driver%3Adrm_ioctls(%20)%0ADriver%20-%3E%20drm_framebuffer%3Adrm_mode_addfb_ioctl(%20)%0Arbox%20over%20drm_framebuffer%3Adrm_mode_addfb(%20)%5Cn%20%20%20%20%20%20%20drm_mode_addfb2(%20)%5Cn%20%20%20%20%20%20%20%5C%2F%5C%2F%E6%9E%84%E5%BB%BA%E5%90%AB%E6%9C%89%E5%A4%9A%E4%B8%AAplane%E7%9A%84framebuffer%EF%BC%8C%E6%AD%A4%E5%A4%84plane%E5%AF%B9%E5%BA%94YUV420%E7%AD%89%E4%B8%AD%E7%9A%84plane%2C%20%5Cn%20%20%20%20%20%20%20%5C%2F%5C%2F%E6%89%80%E4%BB%A5%E5%8F%AF%E8%83%BD%E5%90%AB%E6%9C%89%E5%A4%9A%E4%B8%AAhandle%EF%BC%8C%E5%AF%B9%E5%88%B0%E5%A4%9A%E4%B8%AAgem%20obj%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20drm_internal_framebuffer_create(%20)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E1%3C%2Fcolor%3E.framebuffer_check()%20%5C%2F%5C%2F%E6%A3%80%E6%9F%A5framebuffer%E5%92%8Cformat%E6%98%AF%E5%90%A6%E4%B8%80%E8%87%B4%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_get_format_info()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(mode_config.funcs-%3Eget_format_info)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23ff00ff%3Emode_config.funcs-%3Eget_format_info()%3C%2Fcolor%3E%5C%2F%5C%2F%E6%A0%B9%E6%8D%AEfmt%E5%BE%97%E5%88%B0%E6%89%80%E6%9C%89format%E4%BF%A1%E6%81%AF%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E2%3C%2Fcolor%3E.%3Ccolor%3A%23ff00ff%3Emode_config.funcs-%3Efb_create(%20)%3C%2Fcolor%3E%0A%0Arbox%20over%20drm_gem_framebuffer_helper%3Adrm_gem_fb_create(%20)%20%5C%2F%5C%2FDRM%20%E6%8F%90%E4%BE%9B%E7%9A%84fb_create(%20)%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%5Cn%20%20%20%20%20drm_gem_fb_create_with_funcs(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E1%3C%2Fcolor%3E.kzalloc%20-%3E%20%E5%88%86%E9%85%8D%20drm_framebuffer%20object%5Cn%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E2%3C%2Fcolor%3E.drm_gem_fb_init_with_funcs()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_gem_fb_init()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E1%3C%2Fcolor%3E.drm_helper_mode_fill_fb_struct()%20%5C%2F%5C%2F%E7%BB%99framebuffer%20object%E7%9A%84%E5%90%84%E5%AD%97%E6%AE%B5%E8%B5%8B%E5%80%BC%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E2%3C%2Fcolor%3E.drm_framebuffer_init()%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%E6%8A%8Aframebuffer%20object%E4%BB%A5drm_mode_object%E7%9A%84%E9%80%9A%E7%94%A8%E7%BB%93%E6%9E%84%E6%8F%92%E5%85%A5%E5%88%B0%E9%93%BE%E8%A1%A8mode_config.fb_list%2C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2Fframebuffer%20object%E6%AD%A3%E5%BC%8F%E5%9C%A8%E7%B3%BB%E7%BB%9F%E6%9C%89%E6%95%88%0A%0Anote%20over%20drm_gem_framebuffer_helper%3Adrm_gem_fb_create_with_%3Ccolor%3A%23red%3Efuncs%3C%2Fcolor%3E(%20)%E4%B8%ADfuncs%E7%9A%84%E8%AF%B4%E6%98%8E%5Cnfuncs%E4%B8%BB%E8%A6%81%E5%AE%9A%E4%B9%89%E4%BA%86%E5%AF%B9gem%20framebuffer%20obj%E7%9A%84%E5%A6%82%E4%B8%8B%E5%9B%9E%E8%B0%83%E6%93%8D%E4%BD%9C%5Cn%5Cn1%2C.destroy%20-%3E%20drm_gem_fb_destroy()%20%5Cn%20%20%20%20%5C%2F%5C%2F%20gem_fb%E7%9A%84%E9%87%8A%E6%94%BE%2C%201.%20drm_framebuffer_cleanup()%20%E6%8A%8Aframebuffer%20obj%E4%BB%8E%E9%93%BE%E8%A1%A8mode_config.fb_list%E4%B8%AD%E7%A7%BB%E5%8E%BB%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202.%20kfree%20-%3E%20drm_framebuffer%20object%5Cn%5Cn2..create_handle%20-%3Edrm_gem_fb_create_handle()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_gem_handle_create()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20drm_gem_handle_create_tail()%5C%2F%5C%2F%E9%80%9A%E8%BF%87IDR%E6%9C%BA%E5%88%B6%EF%BC%8C%E6%8A%8Aframebuffer%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAgem_obj%E5%92%8C%E4%B8%80%E4%B8%AAID%E5%85%B3%E8%81%94%EF%BC%8C%E5%B9%B6%E6%8A%8AID%E4%BD%9C%E4%B8%BAhandle%E8%BF%94%E5%9B%9E%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23ff00ff%3Eobj-%3Efuncs-%3Eopen()%3C%2Fcolor%3E%20%5C%2F%5C%2F%20gem%20open%20callback%20function%2C%20%E5%A6%82%E6%9E%9C%E4%B8%8D%E7%A9%BA%E6%89%8Dcall%5Cn%5Cn3..dirty%20-%3Edrm_atomic_helper_dirtyfb()%20%5C%2F%5C%2F%20%3Ccolor%3A%23yellow%3ETODO%3A%3C%2Fcolor%3E</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1849" height="1151"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 43.70612426073828 103.10369087072726 L 43.70612426073828 1151.5724319107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 220.98974600416275 103.10369087072726 L 220.98974600416275 1151.5724319107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 499.5261143296185 103.10369087072726 L 499.5261143296185 1151.5724319107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 831.5903612265327 103.10369087072726 L 831.5903612265327 1151.5724319107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1340.6945708920014 103.10369087072726 L 1340.6945708920014 1151.5724319107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878699999996 55.60594589072727 L 78.61636982147655 55.60594589072727 L 78.61636982147655 103.10369087072726 L 8.795878699999996 103.10369087072726 L 8.795878699999996 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">User</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 178.97856355377604 55.60594589072727 L 263.00092845454947 55.60594589072727 L 263.00092845454947 103.10369087072726 L 178.97856355377604 103.10369087072726 L 178.97856355377604 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="198.06562033277604" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">libdrm</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 459.3474361516927 55.60594589072727 L 539.7047925075443 55.60594589072727 L 539.7047925075443 103.10369087072726 L 459.3474361516927 103.10369087072726 L 459.3474361516927 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="478.4344929306927" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Driver</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 753.2191171306381 55.60594589072727 L 909.9616053224272 55.60594589072727 L 909.9616053224272 103.10369087072726 L 753.2191171306381 103.10369087072726 L 753.2191171306381 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="772.3061739096381" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_framebuffer</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1217.77428504806 55.60594589072727 L 1463.6148567359428 55.60594589072727 L 1463.6148567359428 103.10369087072726 L 1217.77428504806 103.10369087072726 L 1217.77428504806 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1236.86134182706" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_framebuffer_helper</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="839.9351425170898" y="26.547561167272725" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmModeAddFb</text></g><g><g><rect fill="white" stroke="none" x="64.52303718407161" y="138.28720567072727" width="135.6497958967578" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="67.16180079407161" y="154.1197873307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drmModeAddFb( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 43.70612426073828 161.15649029072728 L 206.5058657448294 161.15649029072728" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(220.98974600416275,161.15649029072728) translate(-220.98974600416275,-161.15649029072728)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 206.32994817082943 153.8265913740606 L 220.98974600416275 161.15649029072728 L 206.32994817082943 168.48638920739396 Z"/></g></g><g><g><rect fill="white" stroke="none" x="241.80665892749613" y="187.54412639072726" width="236.90254247878906" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="244.44542253749614" y="203.37670805072727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">ioctl(DRM_IOCTL_MODE_ADDFB)</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 220.98974600416275 210.41341101072726 L 485.0422340702852 210.41341101072726" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(499.5261143296185,210.41341101072726) translate(-499.5261143296185,-210.41341101072726)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 484.86631649628515 203.08351209406058 L 499.5261143296185 210.41341101072726 L 484.86631649628515 217.74330992739394 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 431.8446754539935 252.63362877072726 L 431.8446754539935 252.63362877072726 A 15.832581659999999 15.832581659999999 0 0 1 447.6772571139935 236.80104711072727 L 551.3749715452435 236.80104711072727 L 551.3749715452435 236.80104711072727 A 15.832581659999999 15.832581659999999 0 0 1 567.2075532052435 252.63362877072726 L 567.2075532052435 261.42950747072723 L 567.2075532052435 261.42950747072723 A 15.832581659999999 15.832581659999999 0 0 1 551.3749715452435 277.26208913072725 L 447.6772571139935 277.26208913072725 L 447.6772571139935 277.26208913072725 A 15.832581659999999 15.832581659999999 0 0 1 431.8446754539935 261.42950747072723 L 431.8446754539935 252.63362877072726" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="456.4731358139935" y="261.42950747072723" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_ioctls( )</text></g><g><g><rect fill="white" stroke="none" x="575.5930352642671" y="303.64972523072726" width="179.93040502761718" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="578.231798874267" y="319.4823068907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mode_addfb_ioctl( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 499.5261143296185 326.51900985072723 L 817.1064809671993 326.51900985072723" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(831.5903612265327,326.51900985072723) translate(-831.5903612265327,-326.51900985072723)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 816.9305633931993 319.1891109340606 L 831.5903612265327 326.51900985072723 L 816.9305633931993 333.8489087673939 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 508.32199302961857 368.7392276107273 L 508.32199302961857 368.7392276107273 A 15.832581659999999 15.832581659999999 0 0 1 524.1545746896186 352.9066459507273 L 1139.0261477634467 352.9066459507273 L 1139.0261477634467 352.9066459507273 A 15.832581659999999 15.832581659999999 0 0 1 1154.8587294234467 368.7392276107273 L 1154.8587294234467 588.6361951107274 L 1154.8587294234467 588.6361951107274 A 15.832581659999999 15.832581659999999 0 0 1 1139.0261477634467 604.4687767707273 L 524.1545746896186 604.4687767707273 L 524.1545746896186 604.4687767707273 A 15.832581659999999 15.832581659999999 0 0 1 508.32199302961857 588.6361951107274 L 508.32199302961857 368.7392276107273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="377.5351063107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mode_addfb( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="395.1268637107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       drm_mode_addfb2( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="412.7186211107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       //构建含有多个plane的framebuffer，此处plane对应YUV420等中的plane, </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="430.3103785107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       //所以可能含有多个handle，对到多个gem obj</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="465.4938933107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">             drm_internal_framebuffer_create( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="500.6774081107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                 </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="606.6940752157905" y="500.6774081107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="615.2910753378608" y="500.6774081107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.framebuffer_check() //检查framebuffer和format是否一致</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="518.2691655107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                      drm_get_format_info()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="535.8609229107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                           if(mode_config.funcs-&gt;get_format_info)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="553.4526803107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                             </text><text fill="#ff00ff" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="658.748396504853" y="553.4526803107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">mode_config.funcs-&gt;get_format_info()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="928.8701616415717" y="553.4526803107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">//根据fmt得到所有format信息</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="532.9504533896186" y="588.6361951107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                 </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="606.6940752157905" y="588.6361951107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="615.2910753378608" y="588.6361951107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.</text><text fill="#ff00ff" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="618.8200670370795" y="588.6361951107274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">mode_config.funcs-&gt;fb_create( )</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 971.1198596164741 646.6889945307273 L 971.1198596164741 646.6889945307273 A 15.832581659999999 15.832581659999999 0 0 1 986.952441276474 630.8564128707274 L 1694.4367005075287 630.8564128707274 L 1694.4367005075287 630.8564128707274 A 15.832581659999999 15.832581659999999 0 0 1 1710.2692821675287 646.6889945307273 L 1710.2692821675287 796.2189324307274 L 1710.2692821675287 796.2189324307274 A 15.832581659999999 15.832581659999999 0 0 1 1694.4367005075287 812.0515140907273 L 986.952441276474 812.0515140907273 L 986.952441276474 812.0515140907273 A 15.832581659999999 15.832581659999999 0 0 1 971.1198596164741 796.2189324307274 L 971.1198596164741 646.6889945307273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="655.4848732307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_fb_create( ) //DRM 提供的fb_create( )内部实现</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="673.0766306307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     drm_gem_fb_create_with_funcs( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="690.6683880307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">          </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1039.1269210506928" y="690.6683880307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1047.723921172763" y="690.6683880307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.kzalloc -&gt; 分配 drm_framebuffer object</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="708.2601454307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">          </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1039.1269210506928" y="708.2601454307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1047.723921172763" y="708.2601454307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.drm_gem_fb_init_with_funcs()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="725.8519028307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                 drm_gem_fb_init()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="743.4436602307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                      </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1091.1812423397553" y="743.4436602307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1099.7782424618256" y="743.4436602307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.drm_helper_mode_fill_fb_struct() //给framebuffer object的各字段赋值</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="761.0354176307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                      </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1091.1812423397553" y="761.0354176307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1099.7782424618256" y="761.0354176307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.drm_framebuffer_init() </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="778.6271750307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                        //把framebuffer object以drm_mode_object的通用结构插入到链表mode_config.fb_list,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="995.748319976474" y="796.2189324307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                        //framebuffer object正式在系统有效</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 840.3862399265327 838.4391501907273 L 1825.1703201974701 838.4391501907273 L 1841.00290185747 854.2717318507273 L 1841.00290185747 1090.0012810107273 L 840.3862399265327 1090.0012810107273 L 840.3862399265327 838.4391501907273 M 1825.1703201974701 838.4391501907273 L 1825.1703201974701 854.2717318507273 L 1841.00290185747 854.2717318507273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="863.0676105507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_fb_create_with_</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1045.3511871029389" y="863.0676105507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">funcs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1082.6382354427826" y="863.0676105507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )中funcs的说明</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="880.6593679507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">funcs主要定义了对gem framebuffer obj的如下回调操作</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="915.8428827507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1,.destroy -&gt; drm_gem_fb_destroy() </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="933.4346401507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    // gem_fb的释放, 1. drm_framebuffer_cleanup() 把framebuffer obj从链表mode_config.fb_list中移去 </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="951.0263975507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                                2. kfree -&gt; drm_framebuffer object</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="986.2099123507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2..create_handle -&gt;drm_gem_fb_create_handle()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="1003.8016697507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                                  drm_gem_handle_create()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="1021.3934271507273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                                     drm_gem_handle_create_tail()//通过IDR机制，把framebuffer的第一个gem_obj和一个ID关联，并把ID作为handle返回</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="1038.9851845507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                                          </text><text fill="#ff00ff" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1047.2048247982514" y="1038.9851845507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">obj-&gt;funcs-&gt;open()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1187.3480132748139" y="1038.9851845507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> // gem open callback function, 如果不空才call</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="865.0147002865326" y="1074.1686993507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3..dirty -&gt;drm_atomic_helper_dirtyfb() // </text><text fill="yellow" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1153.6117461849701" y="1074.1686993507274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">TODO:</text></g></g><g/><g/><g/><g/><g/></g></svg>