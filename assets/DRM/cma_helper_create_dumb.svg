<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2031" height="1904"><desc>title%20drm_gem_cma_helper%0A%0A%0Aparticipant%20driver%0A%0A%0Aparticipant%20cma_helper%0Aparticipant%20drm_gem%0Aparticipant%20vma_mamager%0Aparticipant%20drm_mm%0A%0A%0Anote%20over%20cma_helper%3A%23define%20DRM_GEM_CMA_DRIVER_OPS%5Cn%20%20DRM_GEM_CMA_DRIVER_OPS_WITH_DUMB_CREATE(drm_gem_cma_dumb_create)%5Cn%20%20%20%20%20%20%20%20.dumb_create%09%09%20%20%20%20%20%20%20%20%20%20%3D%20drm_gem_cma_dumb_create%2C%5Cn%20%20%20%20%20%20%20%20.prime_handle_to_fd%09%3D%20drm_gem_prime_handle_to_fd%2C%5Cn%20%20%20%20%20%20%20%20.prime_fd_to_handle%09%3D%20drm_gem_prime_fd_to_handle%2C%5Cn%20%20%20%20%20%20%20%20.gem_prime_mmap%09%09%3D%20drm_gem_prime_mmap%5Cn%20%20%20%20%20%20%20%20.gem_prime_import_sg_table%20%3D%20drm_gem_cma_prime_import_sg_table%2C%20%0A%3D%3Dcreate%20dumb%3D%3D%0Adriver%20-%3E%20cma_helper%3Adrm_gem_shmem_dumb_create(%20)%5Cn%20%20%20%20%20%20%20%20%20%5C-%5C-%3Edrm_gem_shmem_create_with_handle(%20)%5Cn%0Arbox%20right%20of%20cma_helper%3A%3Cbackground%3A%23yellow%3E1.%20drm_gem_cma_create%3C%2Fbackground%3E(%20)%20%20%5C-%5C-%3E%20%3Ccolor%3A%23red%3Edrm_gem_cma_object%3C%2Fcolor%3E%5Cn%20%20%20%20%20%20%20%20%20%20%3Cbackground%3A%23pink%3E%5Cn%20%20%20%20%20%20%20%20%20%20%20__drm_gem_cma_create(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%20dma_alloc_noncoherent(%20)%20or%20dma_alloc_wc(%20)%20%5C%2F%5C%2F%E5%88%86%E9%85%8Dcma%20page%E5%BE%97%E5%88%B0cmd_obj-%3Evaddr%20%3C%2Fbackground%3E%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20__drm_gem_cma_create(%20)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20a.%20%5C%2F%5C%2F%E5%88%86%E9%85%8Dgem_object%E5%86%85%E5%AD%98%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%20driver-%3Egem_create_object%20%EF%BC%81%3D%20NULL)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gem_obj%20%3D%20driver-%3Egem_create_object(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20or%20%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gem_obj%20%3D%20kzalloc(%20)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20b.%20%5C%2F%5C%2F%E8%AE%BE%E7%BD%AEfuncs%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20obj-%3Efuncs%20%3D%20%26%3Ccolor%3A%23blue%3Edrm_gem_cma_default_funcs%3C%2Fcolor%3E%0A%0Anote%20left%20of%20cma_helper%3A%3Ccolor%3A%23blue%3Edrm_gem_cma_default_funcs%3C%2Fcolor%3E%20%3D%20%7B%5Cn%09.free%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20drm_gem_cma_free_object%2C%5Cn%09.print_info%20%20%20%20%20%3D%20drm_gem_cma_print_info%2C%5Cn%09.get_sg_table%20%3D%20drm_gem_cma_get_sg_table%2C%5Cn%09.vmap%20%20%20%20%20%20%20%20%20%20%20%20%3D%20drm_gem_cma_vmap%2C%5Cn%09.mmap%20%20%20%20%20%20%20%20%20%20%20%3D%20drm_gem_cma_mmap%2C%5Cn%09.vm_ops%20%20%20%20%20%20%20%20%20%3D%20%26drm_gem_cma_vm_ops%2C%5C%2F%5C%2F%E5%8F%AA%E6%98%AFopen%2Cclose%E6%93%8D%E4%BD%9C%5Cn%7D%3B%0Acma_helper%20-%3E%20drm_gem%3Ac.%20%5C%2F%5C%2F%E5%88%9D%E5%A7%8B%E5%8C%96%20gem_obj%5Cn%20%20%20drm_gem_object_init(%20)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0Arbox%20right%20of%20drm_gem%3A1.%20drm_gem_private_object_init(%20)%5Cn%5Cn%20%20%20%20%20%20a.kref_init()%5Cn%5Cn%20%20%20%20%20%20b.dma_rest_init()%5Cn%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20%3Ccolor%3A%23red%3Estruct%20dma_resv%3C%2Fcolor%3E%2C%E7%94%A8%E5%AE%83%E6%9D%A5%E7%AE%A1%E7%90%86%E4%B8%80%E7%BB%84dma-fences%5Cn%5Cn%20%20%20%20%20%20c.%20drm_vma_node_reset()%5Cn%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20%3Ccolor%3A%23red%3Estruct%20drm_vma_offset_node%2C%20%3C%2Fcolor%3E%5Cn%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20Mapping%20info%20for%20this%20object%20to%20support%20mmap%5Cn%5Cn2.%20shmem_file_setup(%20)%5Cn%20%20%20%5C%2F%5C%2F%E7%94%A8%E4%BA%8E%E5%88%9B%E5%BB%BA%E5%8C%BF%E5%90%8D%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%5Cn%0Acma_helper-%3Edrm_gem%3Ad.%20%5C%2F%5C%2F%20mmap_offset%5Cn%20%20%20drm_gem_create_mmap_offset(%20)%5Cn%20%20%20%20%20%20%20%5C-%5C-%3Edrm_gem_create_mmap_offset_size(%20)%0A%0A%0Adrm_gem%20-%3E%20vma_mamager%3Adrm_vms_offset_add(%20)%0Avma_mamager-%3Edrm_mm%3Adrm_mm_insert_node_generic()%20%5Cndrm_mm_insert_node_in_range(%20)%0A%0A%0A%0A%0A%0A%0A%0Acma_helper-%3Edrm_gem%3A%3Cbackground%3A%23yellow%3E2.%20drm_gem_handle_create%3C%2Fbackground%3E(%20)%5Cn%20%20%20%20%20%20%20%5C-%5C-%3Edrm_gem_handle_create_tail(%20)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0Arbox%20right%20of%20drm_gem%3A1.%20idr_alloc()%20%5C%2F%5C%2F%E5%88%86%E9%85%8D%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%BC%8FID%5Cn%5Cn2.%20drm_vma_node_allow(%20)%20%5Cn%20%20%20%20%5C%2F%5C%2F%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AAdrm_file%E5%88%B0%E8%AF%A5gem_obj%E7%9A%84%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%5Cn%20%20%20%20%5C%2F%5C%2Fdrm_file%E5%AF%B9%E5%BA%94%E5%88%B0%E4%B8%80%E4%B8%AAApp%20%E6%89%93%E5%BC%80%E7%9A%84drm%5Cn%5Cn3.%20if%20no%20NULL%5Cn%20%20%20%20%20%20gem_obj-%3Efuncs-%3E%3Ccolor%3A%23red%3Eopen%3C%2Fcolor%3E(%20)%0Acma_helper-%3Edrm_gem%3A%3Cbackground%3A%23yellow%3E3.%20drm_gem_object_put%3C%2Fbackground%3E(%20)%5Cn%20%20%20%20%20%5C-%5C-%3E%20__drm_gem_object_put()%5Cn%20%20%20%20%20%20%20%20%20%20%5C-%5C-%3Ekref_put(%26obj-%3Erefcount%2C%20drm_gem_object_free)%3B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="2031" height="1904"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.07978148730078 103.10369087072726 L 48.07978148730078 1904.4996486307268" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 103.10369087072726 L 555.7015461551523 1904.4996486307268" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1249.522331208746 103.10369087072726 L 1249.522331208746 1904.4996486307268" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1692.9922404078475 103.10369087072726 L 1692.9922404078475 1904.4996486307268" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1972.0153183280297 103.10369087072726 L 1972.0153183280297 1904.4996486307268" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878699999996 55.60594589072727 L 87.36368427460155 55.60594589072727 L 87.36368427460155 103.10369087072726 L 8.795878699999996 103.10369087072726 L 8.795878699999996 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">driver</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 496.4713237877734 55.60594589072727 L 614.9317685225312 55.60594589072727 L 614.9317685225312 103.10369087072726 L 496.4713237877734 103.10369087072726 L 496.4713237877734 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="515.5583805667734" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">cma_helper</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1197.0923789219335 55.60594589072727 L 1301.9522834955585 55.60594589072727 L 1301.9522834955585 103.10369087072726 L 1197.0923789219335 103.10369087072726 L 1197.0923789219335 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1216.1794357009335" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1622.36615927582 55.60594589072727 L 1763.6183215398748 55.60594589072727 L 1763.6183215398748 103.10369087072726 L 1622.36615927582 103.10369087072726 L 1622.36615927582 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1641.4532160548201" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">vma_mamager</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1921.5646064586977 55.60594589072727 L 2022.4660301973618 55.60594589072727 L 2022.4660301973618 103.10369087072726 L 1921.5646064586977 103.10369087072726 L 1921.5646064586977 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1940.6516632376977" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mm</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="903.7987747192383" y="26.547561167272725" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_cma_helper</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 237.61912156175384 138.28720567072725 L 857.9513890885507 138.28720567072725 L 873.7839707485507 154.11978733072723 L 873.7839707485507 284.29879209072726 L 237.61912156175384 284.29879209072726 L 237.61912156175384 138.28720567072725 M 857.9513890885507 138.28720567072725 L 857.9513890885507 154.11978733072723 L 873.7839707485507 154.11978733072723" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="162.91566603072727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">#define DRM_GEM_CMA_DRIVER_OPS</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="180.50742343072727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">  DRM_GEM_CMA_DRIVER_OPS_WITH_DUMB_CREATE(drm_gem_cma_dumb_create)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="198.09918083072728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        .dumb_create            = drm_gem_cma_dumb_create,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="215.69093823072728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        .prime_handle_to_fd = drm_gem_prime_handle_to_fd,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="233.2826956307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        .prime_fd_to_handle = drm_gem_prime_fd_to_handle,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="250.8744530307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        .gem_prime_mmap  = drm_gem_prime_mmap</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="262.24758192175386" y="268.4662104307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        .gem_prime_import_sg_table = drm_gem_cma_prime_import_sg_table, </text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 8.7958787 325.0530300673939 L 2022.2041213 325.0530300673939 M 8.7958787 330.91694920072723 L 2022.2041213 330.91694920072723 M 8.7958787 336.7808683340606 L 2022.2041213 336.7808683340606" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 946.5372500892188 310.68642819072727 L 1084.4627499107814 310.68642819072727 L 1084.4627499107814 351.14747021072725 L 946.5372500892188 351.14747021072725 Z" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="971.1657104492188" y="335.31488855072723" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">create dumb</text></g><g><g><rect fill="white" stroke="none" x="128.32846881474217" y="377.53510631072726" width="241.74145544265625" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="128.32846881474217" y="395.12686371072726" width="347.1243900129688" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="128.32846881474217" y="412.71862111072727" width="5.27752722" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.96723242474218" y="393.3676879707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_shmem_dumb_create( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="130.96723242474218" y="410.9594453707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">         --&gt;drm_gem_shmem_create_with_handle( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.07978148730078 435.58790573072724 L 541.217665895819 435.58790573072724" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(555.7015461551523,435.58790573072724) translate(-555.7015461551523,-435.58790573072724)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 541.041748321819 428.2580068140606 L 555.7015461551523 435.58790573072724 L 541.041748321819 442.9178046473939 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 605.3483646407273 L 564.4974248551523 605.3483646407273 M 564.4974248551523 477.8081234907272 L 564.4974248551523 477.8081234907272 A 15.832581659999999 15.832581659999999 0 0 1 580.3300065151523 461.9755418307272 L 1224.8938708487462 461.9755418307272 L 1224.8938708487462 461.9755418307272 A 15.832581659999999 15.832581659999999 0 0 1 1240.7264525087462 477.8081234907272 L 1240.7264525087462 732.8886057907273 L 1240.7264525087462 732.8886057907273 A 15.832581659999999 15.832581659999999 0 0 1 1224.8938708487462 748.7211874507273 L 580.3300065151523 748.7211874507273 L 580.3300065151523 748.7211874507273 A 15.832581659999999 15.832581659999999 0 0 1 564.4974248551523 732.8886057907273 L 564.4974248551523 477.8081234907272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><g><rect fill="yellow" stroke="none" x="589.1258852151523" y="473.58610171472725" width="168.30355834960938" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="486.6040021907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. drm_gem_cma_create</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="757.4294435647616" y="486.6040021907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )  --&gt; </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="808.130935874332" y="486.6040021907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_cma_object</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="504.1957595907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">          </text><g><rect fill="pink" stroke="none" x="589.1258852151523" y="508.7696165147272" width="226.8289031982422" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="521.7875169907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           __drm_gem_cma_create( )</text><g><rect fill="pink" stroke="none" x="589.1258852151523" y="526.3613739147272" width="626.9720458984375" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="539.3792743907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           dma_alloc_noncoherent( ) or dma_alloc_wc( ) //分配cma page得到cmd_obj-&gt;vaddr </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="574.5627891907272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           __drm_gem_cma_create( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="609.7463039907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                 a. //分配gem_object内存</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="627.3380613907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                   if( driver-&gt;gem_create_object ！= NULL)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="644.9298187907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                      gem_obj = driver-&gt;gem_create_object( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="662.5215761907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                   or </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="680.1133335907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                      gem_obj = kzalloc( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="715.2968483907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                 b. //设置funcs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="589.1258852151523" y="732.8886057907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                            obj-&gt;funcs = &amp;</text><text fill="blue" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="819.9918367532382" y="732.8886057907273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_cma_default_funcs</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 856.9104954607272 L 546.9056674551523 856.9104954607272 M 56.87566018730075 775.1088235507273 L 531.0730857951523 775.1088235507273 L 546.9056674551523 790.9414052107272 L 546.9056674551523 938.7121673707272 L 56.87566018730075 938.7121673707272 L 56.87566018730075 775.1088235507273 M 531.0730857951523 775.1088235507273 L 531.0730857951523 790.9414052107272 L 546.9056674551523 790.9414052107272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="blue" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="799.7372839107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_cma_default_funcs</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="283.65879889202733" y="799.7372839107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> = {</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="817.3290413107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> .free              = drm_gem_cma_free_object,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="834.9207987107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> .print_info     = drm_gem_cma_print_info,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="852.5125561107272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> .get_sg_table = drm_gem_cma_get_sg_table,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="870.1043135107273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> .vmap            = drm_gem_cma_vmap,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="887.6960709107273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> .mmap           = drm_gem_cma_mmap,</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="905.2878283107273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> .vm_ops         = &amp;drm_gem_cma_vm_ops,//只是open,close操作</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="922.8795857107273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">};</text></g><g><g><rect fill="white" stroke="none" x="744.0677643053476" y="965.0998034707271" width="141.941833860625" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="744.0677643053476" y="982.6915608707271" width="317.08834875320315" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="746.7065279153476" y="980.9323851307271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">c. //初始化 gem_obj</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="746.7065279153476" y="998.5241425307271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   drm_gem_object_init( )                                </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 1005.5608454907272 L 1235.0384509494127 1005.5608454907272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1249.522331208746,1005.5608454907272) translate(-1249.522331208746,-1005.5608454907272)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1234.8625333754126 998.2309465740605 L 1249.522331208746 1005.5608454907272 L 1234.8625333754126 1012.8907444073939 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1249.522331208746 1166.525425700727 L 1258.318209908746 1166.525425700727 M 1258.318209908746 1047.7810632507271 L 1258.318209908746 1047.7810632507271 A 15.832581659999999 15.832581659999999 0 0 1 1274.150791568746 1031.9484815907272 L 1668.3637800478475 1031.9484815907272 L 1668.3637800478475 1031.9484815907272 A 15.832581659999999 15.832581659999999 0 0 1 1684.1963617078475 1047.7810632507271 L 1684.1963617078475 1285.2697881507272 L 1684.1963617078475 1285.2697881507272 A 15.832581659999999 15.832581659999999 0 0 1 1668.3637800478475 1301.1023698107272 L 1274.150791568746 1301.1023698107272 L 1274.150791568746 1301.1023698107272 A 15.832581659999999 15.832581659999999 0 0 1 1258.318209908746 1285.2697881507272 L 1258.318209908746 1047.7810632507271" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1056.576941950727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. drm_gem_private_object_init( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1091.760456750727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      a.kref_init()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1126.943971550727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      b.dma_rest_init()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1144.535728950727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        // </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1334.5142667042928" y="1144.535728950727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">struct dma_resv</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1444.5214230763631" y="1144.535728950727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">,用它来管理一组dma-fences</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1179.719243750727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      c. drm_vma_node_reset()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1197.311001150727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        // </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1334.5142667042928" y="1197.311001150727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">struct drm_vma_offset_node, </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1214.902758550727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">        // Mapping info for this object to support mmap</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1250.086273350727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. shmem_file_setup( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1267.678030750727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   //用于创建匿名共享内存</text></g><g><g><rect fill="white" stroke="none" x="742.5930786364023" y="1327.4900059107272" width="130.66050756667968" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="742.5930786364023" y="1345.0817633107272" width="246.3441318342578" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="742.5930786364023" y="1362.6735207107272" width="320.0377200910938" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="745.2318422464023" y="1343.3225875707271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">d. // mmap_offset</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="745.2318422464023" y="1360.9143449707271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   drm_gem_create_mmap_offset( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="745.2318422464023" y="1378.5061023707271" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       --&gt;drm_gem_create_mmap_offset_size( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 1385.542805330727 L 1235.0384509494127 1385.542805330727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1249.522331208746,1385.542805330727) translate(-1249.522331208746,-1385.542805330727)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1234.8625333754126 1378.2129064140604 L 1249.522331208746 1385.542805330727 L 1234.8625333754126 1392.8727042473938 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1389.93560746441" y="1411.9304414307271" width="162.64335668777343" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1392.57437107441" y="1427.763023090727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_vms_offset_add( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1249.522331208746 1434.799726050727 L 1678.5083601485142 1434.799726050727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1692.9922404078475,1434.799726050727) translate(-1692.9922404078475,-1434.799726050727)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1678.332442574514 1427.4698271340603 L 1692.9922404078475 1434.799726050727 L 1678.332442574514 1442.1296249673937 Z"/></g></g><g><g><rect fill="white" stroke="none" x="1713.8091533311806" y="1461.187362150727" width="229.3506015608203" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="1713.8091533311806" y="1478.779119550727" width="237.38925207351562" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1716.4479169411807" y="1477.019943810727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mm_insert_node_generic() </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1716.4479169411807" y="1494.611701210727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mm_insert_node_in_range( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1692.9922404078475 1501.648404170727 L 1957.5314380686964 1501.648404170727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1972.0153183280297,1501.648404170727) translate(-1972.0153183280297,-1501.648404170727)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1957.3555204946963 1494.3185052540603 L 1972.0153183280297 1501.648404170727 L 1957.3555204946963 1508.9783030873937 Z"/></g></g><g><g><rect fill="white" stroke="none" x="649.651237510914" y="1528.036040270727" width="206.279724485625" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="649.651237510914" y="1545.627797670727" width="505.92140234207034" height="22.86928462"/></g><g><rect fill="yellow" stroke="none" x="652.290001120914" y="1530.850721454727" width="186.87191772460938" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="652.290001120914" y="1543.868621930727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. drm_gem_handle_create</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="839.1619188455234" y="1543.868621930727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="652.290001120914" y="1561.460379330727" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       --&gt;drm_gem_handle_create_tail( )                                                      </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 1568.497082290727 L 1235.0384509494127 1568.497082290727" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1249.522331208746,1568.497082290727) translate(-1249.522331208746,-1568.497082290727)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1234.8625333754126 1561.1671833740602 L 1249.522331208746 1568.497082290727 L 1234.8625333754126 1575.8269812073936 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1249.522331208746 1676.6863903007268 L 1258.318209908746 1676.6863903007268 M 1258.318209908746 1610.7173000507269 L 1258.318209908746 1610.7173000507269 A 15.832581659999999 15.832581659999999 0 0 1 1274.150791568746 1594.884718390727 L 1599.9386854433553 1594.884718390727 L 1599.9386854433553 1594.884718390727 A 15.832581659999999 15.832581659999999 0 0 1 1615.7712671033553 1610.7173000507269 L 1615.7712671033553 1742.655480550727 L 1615.7712671033553 1742.655480550727 A 15.832581659999999 15.832581659999999 0 0 1 1599.9386854433553 1758.4880622107269 L 1274.150791568746 1758.4880622107269 L 1274.150791568746 1758.4880622107269 A 15.832581659999999 15.832581659999999 0 0 1 1258.318209908746 1742.655480550727 L 1258.318209908746 1610.7173000507269" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1619.5131787507266" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1. idr_alloc() //分配一个正式ID</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1654.6966935507266" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2. drm_vma_node_allow( ) </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1672.2884509507267" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    //添加一个drm_file到该gem_obj的用户列表</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1689.8802083507267" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    //drm_file对应到一个App 打开的drm</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1725.0637231507267" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. if no NULL</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1282.946670268746" y="1742.6554805507267" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      gem_obj-&gt;funcs-&gt;</text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1441.29312107441" y="1742.6554805507267" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">open</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1477.3274838673788" y="1742.6554805507267" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text></g><g><g><rect fill="white" stroke="none" x="650.6496963732187" y="1784.8756983107269" width="183.28758276199218" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="650.6496963732187" y="1802.4674557107269" width="225.21311987136718" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="650.6496963732187" y="1820.059213110727" width="503.92448461746096" height="22.86928462"/></g><g><rect fill="yellow" stroke="none" x="653.2884599832187" y="1787.6903794947268" width="163.87977600097656" height="17.767674974"/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="653.2884599832187" y="1800.7082799707268" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3. drm_gem_object_put</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="817.1682359841952" y="1800.7082799707268" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="653.2884599832187" y="1818.3000373707268" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">     --&gt; __drm_gem_object_put()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="653.2884599832187" y="1835.8917947707268" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">          --&gt;kref_put(&amp;obj-&gt;refcount, drm_gem_object_free);                     </text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 555.7015461551523 1842.9284977307268 L 1235.0384509494127 1842.9284977307268" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1249.522331208746,1842.9284977307268) translate(-1249.522331208746,-1842.9284977307268)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1234.8625333754126 1835.59859881406 L 1249.522331208746 1842.9284977307268 L 1234.8625333754126 1850.2583966473935 Z"/></g></g></g><g/><g/><g/><g/><g/></g></g></g></g></g></g></svg>