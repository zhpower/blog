<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1833" height="1024"><desc>title%20cma%20helper%20for%20mmap%0A%0Aparticipant%20driver%0Aparticipant%20drm_dumb_buffer%0Aparticipant%20drm_gem%0Aparticipant%20cma_helper%0A%0A%3D%3Dmmap%3D%3D%0Adriver-%3Edrm_dumb_buffer%3Adrm_mode_mmap_dumb_ioctl(%20)%0Arbox%20left%20of%20drm_dumb_buffer%3Adrm_gem_dumb_map_offset(%20)%5Cn%5Cn%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E1%3C%2Fcolor%3E.drm_gem_object_lookup()%20%5C%2F%5C%2F%20handle%20%5C-%5C-%3E%20gem_object%5Cn%5Cn%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E2%3C%2Fcolor%3E.drm_gem_create_mmap_offset()%5Cn%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAfake%20offset%20%E8%BF%94%E5%9B%9E%E7%BB%99%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%EF%BC%8C%E5%BD%93%E7%94%A8%E6%88%B7map%E5%AF%B9%E5%BA%94%E7%9A%84gem_object%E6%97%B6%EF%BC%8C%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%E7%B3%BB%E7%BB%9F%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%BF%99%E4%B8%AAoffset%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84gem_object%20%E4%BB%8E%E8%80%8C%E5%BB%BA%E7%AB%8Bmemory%20mapping%5Cn%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C-%5C-%3Edrm_gem_create_mmap_offset_size()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C-%5C-%3Edrm_vma_offset_add()%5Cn%5Cn%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23red%3E3%3C%2Fcolor%3E.drm_vma_node_offset_addr()%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5C%2F%5C%2F%20vm_node.start%20%3C%3C%20PAGE_SHIFT%20%5C-%5C-%3E%20offset%0Arbox%20right%20of%20driver%3A%E5%9C%A8%3Ccolor%3A%23ff00ff%3Edrm_driver.fops.mmap%3C%2Fcolor%3E(%20)%E4%B8%AD%E8%AE%BE%E7%BD%AE%E5%AF%B9%E5%BA%94%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0%5Cn%5Cn%20%20%20%20%E5%9C%A8%E5%9F%BA%E4%BA%8EGEM%E7%9A%84%E5%AE%9E%E7%8E%B0%E4%B8%AD%EF%BC%8C%E5%8F%AF%E9%80%9A%E8%BF%87%E8%B0%83%E7%94%A8drm_gem_mmap()%E6%9D%A5%E5%AE%9E%E7%8E%B0%0Adriver-%3Edrm_gem%3Adrm_gem_mmap(%20)%0Arbox%20left%20of%20drm_gem%3A%20%20%20%20drm_gem_mmap(%20)%20%5C%2F%5C%2F%E9%BB%98%E8%AE%A4%E7%9A%84gem%20mmap%E5%AE%9E%E7%8E%B0%5Cn%20%20%20%20%20%20%201.%20vma.vm_pgoff%20%5C-%5C-%3E%20vm_node%20%5C-%5C-%3E%20gem_object%5Cn%20%20%20%20%20%20%202.drm_gem_mmap_obj(%20)%5Cn%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ccolor%3A%23ff00ff%3Eobj-%3Efuncs-%3Emmap(%20)%3C%2Fcolor%3E%20%5C%2F%5C%2F%20if%20not%20null(%E5%9C%A8dumb_create%E4%B8%AD%E8%AE%BE%E7%BD%AE)%0Adrm_gem-%3Ecma_helper%3A%3Ccolor%3A%23ff00ff%3Eobj-%3Efuncs-%3Emmap(%20)%3C%2Fcolor%3E%20%5Cn%20%20%20%20%20%20drm_gem_cma_mmap(%20)%20%20%5C%2F%5C%2F%E5%9C%A8drm_gem_shmem_dumb_create(%20)%E8%AE%BE%E7%BD%AE%0Arbox%20left%20of%20cma_helper%3Adrm_gem_cma_mmap(%20)%20%5C%2F%5C%2F%E8%B0%83%E7%94%A8dma%E5%87%BD%E6%95%B0%E5%81%9Amap%5Cn%20%20%20dma_mmap_pages(%20)%3B%20%5C%2F%5C%2F%20virt_to_page(cma_obj-%3Evaddr)%5Cn%20%20%20%3Ccolor%3A%23green%3Eor%3C%2Fcolor%3E%5Cn%20%20%20dma_mmap_wc(%20)%0A</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="1833" height="1024"/></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.07978148730078 103.10369087072726 L 48.07978148730078 1024.9117786307272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 685.7086720096446 103.10369087072726 L 685.7086720096446 1024.9117786307272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1223.2301559157775 103.10369087072726 L 1223.2301559157775 1024.9117786307272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1765.9039754131081 103.10369087072726 L 1765.9039754131081 1024.9117786307272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray="13.532121076923076,5.863919133333333"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 8.795878699999996 55.60594589072727 L 87.36368427460155 55.60594589072727 L 87.36368427460155 103.10369087072726 L 8.795878699999996 103.10369087072726 L 8.795878699999996 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="27.882935478999997" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">driver</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 603.7153728600391 55.60594589072727 L 767.7019711592501 55.60594589072727 L 767.7019711592501 103.10369087072726 L 603.7153728600391 103.10369087072726 L 603.7153728600391 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="622.8024296390391" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_dumb_buffer</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1170.800203628965 55.60594589072727 L 1275.66010820259 55.60594589072727 L 1275.66010820259 103.10369087072726 L 1170.800203628965 103.10369087072726 L 1170.800203628965 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1189.887260407965" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1706.6737530457292 55.60594589072727 L 1825.134197780487 55.60594589072727 L 1825.134197780487 103.10369087072726 L 1706.6737530457292 103.10369087072726 L 1706.6737530457292 55.60594589072727 Z" stroke-miterlimit="10" stroke-width="2.814681184" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1725.7608098247292" y="85.51193347072726" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">cma_helper</text></g></g><g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16pt" font-style="normal" font-weight="normal" text-decoration="normal" x="806.1631546020508" y="26.547561167272725" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">cma helper for mmap</text></g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 8.7958787 152.65380754739394 L 1824.2041213 152.65380754739394 M 8.7958787 158.51772668072726 L 1824.2041213 158.51772668072726 M 8.7958787 164.3816458140606 L 1824.2041213 164.3816458140606" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 869.4019580359961 138.28720567072725 L 963.598041964004 138.28720567072725 L 963.598041964004 178.74824769072723 L 869.4019580359961 178.74824769072723 Z" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="894.0304183959961" y="162.9156660307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">mmap</text></g><g><g><rect fill="white" stroke="none" x="251.13803149784763" y="205.13588379072726" width="231.51239050125" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="253.77679510784765" y="220.96846545072728" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_mode_mmap_dumb_ioctl( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.07978148730078 228.00516841072726 L 671.2247917503113 228.00516841072726" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(685.7086720096446,228.00516841072726) translate(-685.7086720096446,-228.00516841072726)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 671.0488741763113 220.6752694940606 L 685.7086720096446 228.00516841072726 L 671.0488741763113 235.33506732739394 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 685.7086720096446 380.17386992072727 L 676.9127933096446 380.17386992072727 M 56.87566018730081 270.2253861707273 L 56.87566018730081 270.2253861707273 A 15.832581659999999 15.832581659999999 0 0 1 72.70824184730081 254.3928045107273 L 661.0802116496446 254.39280451072727 L 661.0802116496446 254.3928045107273 A 15.832581659999999 15.832581659999999 0 0 1 676.9127933096446 270.2253861707273 L 676.9127933096446 490.1223536707273 L 676.9127933096446 490.1223536707273 A 15.832581659999999 15.832581659999999 0 0 1 661.0802116496446 505.9549353307273 L 72.70824184730081 505.9549353307273 L 72.70824184730081 505.9549353307273 A 15.832581659999999 15.832581659999999 0 0 1 56.87566018730081 490.1223536707273 L 56.87566018730081 270.2253861707273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="279.0212648707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_dumb_map_offset( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="314.2047796707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">         </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="120.5448615140977" y="314.2047796707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">1</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="129.14186163616802" y="314.2047796707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.drm_gem_object_lookup() // handle --&gt; gem_object</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="349.3882944707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">         </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="120.5448615140977" y="349.3882944707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">2</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="129.14186163616802" y="349.3882944707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.drm_gem_create_mmap_offset()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="366.9800518707273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">           // 创建一个fake offset 返回给用户空间，当用户map对应的gem_object时，</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="384.57180927072733" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                系统可以通过这个offset找到对应的gem_object 从而建立memory mapping</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="419.75532407072734" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                --&gt;drm_gem_create_mmap_offset_size()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="437.34708147072735" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                                           --&gt;drm_vma_offset_add()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="472.53059627072736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">         </text><text fill="red" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="120.5448615140977" y="472.53059627072736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">3</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="129.14186163616802" y="472.53059627072736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">.drm_vma_node_offset_addr()</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730083" y="490.12235367072736" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                       // vm_node.start &lt;&lt; PAGE_SHIFT --&gt; offset</text></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 48.07978148730078 570.1648498407274 L 56.87566018730078 570.1648498407274 M 56.87566018730078 548.1751530907272 L 56.87566018730078 548.1751530907272 A 15.832581659999999 15.832581659999999 0 0 1 72.70824184730078 532.3425714307273 L 503.48545456956634 532.3425714307273 L 503.48545456956634 532.3425714307273 A 15.832581659999999 15.832581659999999 0 0 1 519.3180362295664 548.1751530907272 L 519.3180362295664 592.1545465907274 L 519.3180362295664 592.1545465907274 A 15.832581659999999 15.832581659999999 0 0 1 503.48545456956634 607.9871282507273 L 72.70824184730078 607.9871282507273 L 72.70824184730078 607.9871282507273 A 15.832581659999999 15.832581659999999 0 0 1 56.87566018730078 592.1545465907274 L 56.87566018730078 548.1751530907272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="556.9710317907274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">在</text><text fill="#ff00ff" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="96.16410895062108" y="556.9710317907274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_driver.fops.mmap</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="253.04315252972265" y="556.9710317907274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">( )中设置对应函数实现</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="81.50412054730077" y="592.1545465907274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">    在基于GEM的实现中，可通过调用drm_gem_mmap()来实现</text></g><g><g><rect fill="white" stroke="none" x="566.8529741955431" y="634.3747643507273" width="137.60398901199218" height="22.86928462"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="569.491737805543" y="650.2073460107273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_mmap( )</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 48.07978148730078 657.2440489707274 L 1208.7462756564441 657.2440489707274" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1223.2301559157775,657.2440489707274) translate(-1223.2301559157775,-657.2440489707274)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1208.570358082444 649.9141500540607 L 1223.2301559157775 657.2440489707274 L 1208.570358082444 664.5739478873941 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1223.2301559157775 730.2498421807273 L 1214.4342772157775 730.2498421807273 M 694.5045507096446 699.4642667307273 L 694.5045507096446 699.4642667307273 A 15.832581659999999 15.832581659999999 0 0 1 710.3371323696446 683.6316850707274 L 1198.6016955557775 683.6316850707274 L 1198.6016955557775 683.6316850707274 A 15.832581659999999 15.832581659999999 0 0 1 1214.4342772157775 699.4642667307273 L 1214.4342772157775 761.0354176307274 L 1214.4342772157775 761.0354176307274 A 15.832581659999999 15.832581659999999 0 0 1 1198.6016955557775 776.8679992907273 L 710.3371323696446 776.8679992907273 L 710.3371323696446 776.8679992907273 A 15.832581659999999 15.832581659999999 0 0 1 694.5045507096446 761.0354176307274 L 694.5045507096446 699.4642667307273" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="719.1330110696447" y="708.2601454307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   drm_gem_mmap( ) //默认的gem mmap实现</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="719.1330110696447" y="725.8519028307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       1. vma.vm_pgoff --&gt; vm_node --&gt; gem_object</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="719.1330110696447" y="743.4436602307273" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">       2.drm_gem_mmap_obj( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="719.1330110696447" y="761.0354176307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">                </text><text fill="#ff00ff" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="788.5387727883947" y="761.0354176307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">obj-&gt;funcs-&gt;mmap( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="941.9246217874181" y="761.0354176307274" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> // if not null(在dumb_create中设置)</text></g><g><g><rect fill="white" stroke="none" x="1244.0470688391108" y="803.2556353907272" width="163.0012363264453" height="22.86928462"/></g><g><rect fill="white" stroke="none" x="1244.0470688391108" y="820.8473927907272" width="501.0399936506641" height="22.86928462"/></g><text fill="#ff00ff" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.6858324491109" y="819.0882170507272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">obj-&gt;funcs-&gt;mmap( )</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1400.0716814481343" y="819.0882170507272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve"> </text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1246.6858324491109" y="836.6799744507272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">      drm_gem_cma_mmap( )  //在drm_gem_shmem_dumb_create( )设置</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 1223.2301559157775 843.7166774107272 L 1751.4200951537748 843.7166774107272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g transform="translate(1765.9039754131081,843.7166774107272) translate(-1765.9039754131081,-843.7166774107272)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 1751.2441775797747 836.3867784940605 L 1765.9039754131081 843.7166774107272 L 1751.2441775797747 851.046576327394 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 1765.9039754131081 916.7224706207272 L 1757.1080967131081 916.7224706207272 M 1313.8353831464285 885.9368951707272 L 1313.8353831464285 885.9368951707272 A 15.832581659999999 15.832581659999999 0 0 1 1329.6679648064285 870.1043135107273 L 1741.2755150531082 870.1043135107273 L 1741.2755150531082 870.1043135107273 A 15.832581659999999 15.832581659999999 0 0 1 1757.1080967131081 885.9368951707272 L 1757.1080967131081 947.5080460707272 L 1757.1080967131081 947.5080460707272 A 15.832581659999999 15.832581659999999 0 0 1 1741.2755150531082 963.3406277307272 L 1329.6679648064285 963.3406277307272 L 1329.6679648064285 963.3406277307272 A 15.832581659999999 15.832581659999999 0 0 1 1313.8353831464285 947.5080460707272 L 1313.8353831464285 885.9368951707272" stroke-miterlimit="10" stroke-width="1.4659797833333332" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1338.4638435064285" y="894.7327738707272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drm_gem_cma_mmap( ) //调用dma函数做map</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1338.4638435064285" y="912.3245312707272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   dma_mmap_pages( ); // virt_to_page(cma_obj-&gt;vaddr)</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1338.4638435064285" y="929.9162886707272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   </text><text fill="green" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1351.477423828694" y="929.9162886707272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">or</text><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="1338.4638435064285" y="947.5080460707272" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">   dma_mmap_wc( )</text></g></g><g/><g/><g/><g/></g></svg>